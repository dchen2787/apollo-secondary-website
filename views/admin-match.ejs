<%- include("./partials/header"); -%>
<div class="container">
  <% if (errM && errM.length) { %>
    <div class="alert alert-info" style="margin:10px 0;"><%= errM %></div>
  <% } %>

  <div class="d-flex align-items-center mb-3">
    <h1 class="h4 mb-0">Match Controls</h1>
    <a class="btn btn-link ml-auto" href="/admin/students">← Students</a>
  </div>

  <!-- Controls form -->
  <div class="card card-body mb-3">
    <form method="post" action="/admin-matchSettings">
      <div class="form-row">
        <div class="form-group col-md-4">
          <label>Phase</label>
          <select class="form-control" name="phase">
            <option value="0" <%= controls?.phase===0?'selected':'' %>>0 — View Only</option>
            <option value="1" <%= controls?.phase===1?'selected':'' %>>1 — PCP Only</option>
            <option value="2" <%= controls?.phase===2?'selected':'' %>>2 — Max 2</option>
            <option value="3" <%= controls?.phase===3?'selected':'' %>>3 — Unlimited</option>
          </select>
        </div>
        <div class="form-group col-md-4">
          <label>Lock matching</label>
          <select class="form-control" name="matchingLock">
            <option value="false" <%= controls?.matchingLocked ? '' : 'selected' %>>Unlocked</option>
            <option value="true"  <%= controls?.matchingLocked ? 'selected' : '' %>>Locked</option>
          </select>
        </div>
        <div class="form-group col-md-4">
          <label>Max slots (informational)</label>
          <input class="form-control" type="number" name="maxSlots" value="<%= maxSlots %>" />
        </div>
      </div>
      <button class="btn btn-primary">Save</button>
    </form>
  </div>

  <!-- Confirmation tools -->
  <div class="card card-body mb-3">
    <h5>Confirmations</h5>
    <form method="post" action="/admin-reset-confirms" onsubmit="return confirm('Clear ALL confirmations?')">
      <button class="btn btn-outline-danger btn-sm">Reset All Confirms</button>
    </form>
    <form class="form-inline mt-2" method="post" action="/admin-clear-confirm">
      <input class="form-control mr-2" name="email" placeholder="student@email" required>
      <button class="btn btn-outline-secondary btn-sm">Clear One</button>
    </form>
  </div>

  <!-- Shadow slots table (read-only list for now) -->
  <div class="card card-body">
    <h5>All Slots (read-only)</h5>
    <div class="table-responsive">
      <table class="table table-sm">
        <thead><tr>
          <th>Physician</th><th>Specialty</th><th>Date</th><th>Start</th><th>End</th><th>Location</th><th>Student</th><th>Email</th>
        </tr></thead>
        <tbody>
          <% (slots || []).forEach(function(s){ %>
            <tr>
              <td><%= s.physName || '' %></td>
              <td><%= s.physSpecialty || '' %></td>
              <td><%= s.dDate || '' %></td>
              <td><%= s.timeStart || '' %></td>
              <td><%= s.timeEnd || '' %></td>
              <td><%= s.location || '' %></td>
              <td><%= s.studentName || '' %></td>
              <td><%= s.studentEmail || '' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<%- include("./partials/footer"); -%>
